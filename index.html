<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reflex Speed Game</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #gameZone { margin: 20px auto; border: 2px solid #000; width: 300px; height: 300px; position: relative; background: #f0f0f0; }
    #target { width: 50px; height: 50px; background: red; position: absolute; border-radius: 50%; display: none; cursor: pointer; }
    #leaderboard { margin-top: 40px; }
    .ad-space { margin: 20px 0; padding: 10px; background: #f9f9f9; min-height: 100px; }
  </style>
</head>
<body>
  <h1>‚ö° Jeu de R√©flexe</h1>

  <div class="ad-space">
    <!-- Bloc publicitaire AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-xxxxxxxxxxxxxxxx" crossorigin="anonymous"></script>
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-xxxxxxxxxxxxxxxx" data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

  <div>
    <label for="pseudo">Entrez votre pseudo :</label>
    <input type="text" id="pseudo" />
    <button onclick="startGame()">Commencer</button>
  </div>

  <div id="gameZone">
    <div id="target"></div>
  </div>

  <h2>Temps de r√©action : <span id="reactionTime">-</span> ms</h2>

  <div class="ad-space">
    <!-- Bloc publicitaire AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-xxxxxxxxxxxxxxxx" crossorigin="anonymous"></script>
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-xxxxxxxxxxxxxxxx" data-ad-slot="0987654321" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

  <div id="leaderboard">
    <h2>üèÜ Top 100 (les plus rapides)</h2>
    <ol id="scoresList"></ol>
  </div>

  <script>
    const supabaseUrl = 'https://qwfzcqtwlgkkqqhskhdx.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3ZnpjcXR3bGdra3FxaHNraGR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MzM1MzYsImV4cCI6MjA2NTMwOTUzNn0.Mblc2bXxQUH1944ZS0tfiNb0qAEw35TrYSUQWSptrdU';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const gameZone = document.getElementById('gameZone');
    const target = document.getElementById('target');
    const reactionTimeDisplay = document.getElementById('reactionTime');
    const pseudoInput = document.getElementById('pseudo');
    let startTime = 0;

    async function startGame() {
      const pseudo = pseudoInput.value.trim();
      if (!pseudo) return alert("Veuillez entrer un pseudo.");

      target.style.display = 'none';
      reactionTimeDisplay.textContent = '-';

      const delay = Math.random() * 3000 + 2000; // entre 2 et 5 sec

      setTimeout(() => {
        const x = Math.random() * (gameZone.clientWidth - 50);
        const y = Math.random() * (gameZone.clientHeight - 50);
        target.style.left = x + 'px';
        target.style.top = y + 'px';
        target.style.display = 'block';
        startTime = performance.now();
      }, delay);
    }

    target.addEventListener('click', async () => {
      const endTime = performance.now();
      const reaction = Math.round(endTime - startTime);
      reactionTimeDisplay.textContent = reaction + ' ms';
      target.style.display = 'none';

      const pseudo = pseudoInput.value.trim();
      if (!pseudo) return;

      await saveScore(pseudo, reaction);
      await loadLeaderboard();
    });

    async function saveScore(pseudo, score) {
      const { error } = await supabase.from('scores').insert([{ pseudo, score }]);
      if (error) console.error(error);
    }

    async function loadLeaderboard() {
      const { data, error } = await supabase
        .from('scores')
        .select('*')
        .order('score', { ascending: true })
        .limit(100);

      const list = document.getElementById('scoresList');
      list.innerHTML = '';

      if (error) {
        console.error(error);
        return;
      }

      data.forEach(entry => {
        const li = document.createElement('li');
        li.textContent = `${entry.pseudo} ‚Äî ${entry.score} ms`;
        list.appendChild(li);
      });
    }

    loadLeaderboard();
  </script>
</body>
</html>
