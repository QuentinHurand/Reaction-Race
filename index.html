<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reflex Game with Leaderboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #gameZone { margin: 20px auto; border: 2px solid #000; width: 300px; height: 300px; position: relative; background: #f0f0f0; }
    #target { width: 50px; height: 50px; background: red; position: absolute; border-radius: 50%; display: none; }
    #leaderboard { margin-top: 40px; }
    .ad-space { margin: 20px 0; padding: 10px; background: #ccc; }
  </style>
</head>
<body>
  <h1>‚ö° Reflex Game</h1>
  <div class="ad-space">[Votre publicit√© ici - haut]</div>

  <div>
    <label for="pseudo">Entrez votre pseudo :</label>
    <input type="text" id="pseudo" />
    <button onclick="startGame()">Commencer</button>
  </div>

  <div id="gameZone">
    <div id="target"></div>
  </div>

  <h2>Score : <span id="score">0</span></h2>

  <div class="ad-space">[Votre publicit√© ici - bas]</div>

  <div id="leaderboard">
    <h2>üèÜ Top 100</h2>
    <ol id="scoresList"></ol>
  </div>

  <script>
    const supabaseUrl = 'https://qwfzcqtwlgkkqqhskhdx.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3ZnpjcXR3bGdra3FxaHNraGR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MzM1MzYsImV4cCI6MjA2NTMwOTUzNn0.Mblc2bXxQUH1944ZS0tfiNb0qAEw35TrYSUQWSptrdU';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    let score = 0;
    let gameStarted = false;
    const target = document.getElementById('target');

    async function startGame() {
      const pseudo = document.getElementById('pseudo').value.trim();
      if (!pseudo) return alert("Veuillez entrer un pseudo.");

      score = 0;
      document.getElementById('score').textContent = score;
      gameStarted = true;
      showTarget();

      setTimeout(() => {
        gameStarted = false;
        target.style.display = 'none';
        saveScore(pseudo, score);
        loadLeaderboard();
      }, 10000); // 10 sec
    }

    function showTarget() {
      if (!gameStarted) return;
      const x = Math.random() * 250;
      const y = Math.random() * 250;
      target.style.left = x + 'px';
      target.style.top = y + 'px';
      target.style.display = 'block';

      setTimeout(() => {
        target.style.display = 'none';
        setTimeout(showTarget, Math.random() * 1000 + 500);
      }, 700);
    }

    target.onclick = () => {
      if (!gameStarted) return;
      score++;
      document.getElementById('score').textContent = score;
    };

    async function saveScore(pseudo, score) {
      const { error } = await supabase.from('scores').insert([{ pseudo, score }]);
      if (error) console.error(error);
    }

    async function loadLeaderboard() {
      const { data, error } = await supabase
        .from('scores')
        .select('*')
        .order('score', { ascending: false })
        .limit(100);

      const list = document.getElementById('scoresList');
      list.innerHTML = '';
      data.forEach((entry) => {
        const li = document.createElement('li');
        li.textContent = `${entry.pseudo} ‚Äî ${entry.score}`;
        list.appendChild(li);
      });
    }

    loadLeaderboard();
  </script>
</body>
</html>
